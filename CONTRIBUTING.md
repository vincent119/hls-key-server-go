# Contributing to HLS Key Server

é¦–å…ˆï¼Œæ„Ÿè¬æ‚¨è€ƒæ…®ç‚º HLS Key Server åšå‡ºè²¢ç»ï¼æˆ‘å€‘æ­¡è¿æ‰€æœ‰å½¢å¼çš„è²¢ç»ã€‚

## ç›®éŒ„

- [è¡Œç‚ºæº–å‰‡](#è¡Œç‚ºæº–å‰‡)
- [å¦‚ä½•è²¢ç»](#å¦‚ä½•è²¢ç»)
- [é–‹ç™¼æµç¨‹](#é–‹ç™¼æµç¨‹)
- [ç¨‹å¼ç¢¼è¦ç¯„](#ç¨‹å¼ç¢¼è¦ç¯„)
- [æäº¤è¨Šæ¯è¦ç¯„](#æäº¤è¨Šæ¯è¦ç¯„)
- [æ¸¬è©¦è¦æ±‚](#æ¸¬è©¦è¦æ±‚)
- [Pull Request æµç¨‹](#pull-request-æµç¨‹)

## è¡Œç‚ºæº–å‰‡

æœ¬å°ˆæ¡ˆéµå¾ªè²¢ç»è€…å…¬ç´„ï¼ˆContributor Covenantï¼‰ã€‚åƒèˆ‡æœ¬å°ˆæ¡ˆå³è¡¨ç¤ºæ‚¨åŒæ„éµå®ˆå…¶æ¢æ¬¾ã€‚

### æˆ‘å€‘çš„æ‰¿è«¾

ç‚ºäº†ç‡Ÿé€ é–‹æ”¾ä¸”å‹å–„çš„ç’°å¢ƒï¼Œæˆ‘å€‘æ‰¿è«¾ï¼š

- ä½¿ç”¨å‹å–„ä¸”åŒ…å®¹çš„èªè¨€
- å°Šé‡ä¸åŒçš„è§€é»å’Œç¶“é©—
- å„ªé›…åœ°æ¥å—å»ºè¨­æ€§æ‰¹è©•
- é—œæ³¨å°ç¤¾ç¾¤æœ€æœ‰åˆ©çš„äº‹æƒ…
- å°å…¶ä»–ç¤¾ç¾¤æˆå“¡è¡¨ç¾åŒç†å¿ƒ

## å¦‚ä½•è²¢ç»

### å›å ± Bug

å¦‚æœæ‚¨ç™¼ç¾ bugï¼Œè«‹ï¼š

1. **æª¢æŸ¥æ˜¯å¦å·²æœ‰ç›¸åŒå•é¡Œ** - æœå°‹ [Issues](https://github.com/vincent119/hls-key-server-go/issues)
2. **å»ºç«‹æ–° Issue** - å¦‚æœå•é¡Œå°šæœªå›å ±ï¼Œè«‹å»ºç«‹æ–°çš„ issue
3. **æä¾›è©³ç´°è³‡è¨Š**ï¼š
   - æ¸…æ¥šçš„æ¨™é¡Œå’Œæè¿°
   - é‡ç¾æ­¥é©Ÿ
   - é æœŸè¡Œç‚º vs å¯¦éš›è¡Œç‚º
   - Go ç‰ˆæœ¬ã€ä½œæ¥­ç³»çµ±
   - ç›¸é—œæ—¥èªŒæˆ–æˆªåœ–

**Bug Report ç¯„æœ¬**ï¼š

```markdown
## æè¿°
ç°¡çŸ­æè¿°å•é¡Œ

## é‡ç¾æ­¥é©Ÿ
1. æ­¥é©Ÿä¸€
2. æ­¥é©ŸäºŒ
3. è§€å¯Ÿåˆ°çš„éŒ¯èª¤

## é æœŸè¡Œç‚º
æ‡‰è©²ç™¼ç”Ÿä»€éº¼

## å¯¦éš›è¡Œç‚º
å¯¦éš›ç™¼ç”Ÿä»€éº¼

## ç’°å¢ƒ
- Go ç‰ˆæœ¬ï¼š1.24.0
- ä½œæ¥­ç³»çµ±ï¼šmacOS 14.0
- å°ˆæ¡ˆç‰ˆæœ¬ï¼šv1.0.0

## æ—¥èªŒ
```
ç›¸é—œéŒ¯èª¤æ—¥èªŒ
```
```

### æè­°æ–°åŠŸèƒ½

å¦‚æœæ‚¨æƒ³æè­°æ–°åŠŸèƒ½ï¼š

1. **é–‹å•Ÿ Discussion** - å…ˆåœ¨ [Discussions](https://github.com/vincent119/hls-key-server-go/discussions) è¨è«–
2. **èªªæ˜ç”¨ä¾‹** - è§£é‡‹ç‚ºä»€éº¼éœ€è¦é€™å€‹åŠŸèƒ½
3. **è€ƒæ…®æ›¿ä»£æ–¹æ¡ˆ** - æ˜¯å¦æœ‰å…¶ä»–å¯¦ä½œæ–¹å¼
4. **ç­‰å¾…åé¥‹** - ç²å¾—ç¶­è­·è€…èªå¯å¾Œå†é–‹å§‹é–‹ç™¼

**Feature Request ç¯„æœ¬**ï¼š

```markdown
## åŠŸèƒ½æè¿°
ç°¡çŸ­æè¿°æ‚¨æƒ³è¦çš„åŠŸèƒ½

## å‹•æ©Ÿ
ç‚ºä»€éº¼éœ€è¦é€™å€‹åŠŸèƒ½ï¼Ÿè§£æ±ºä»€éº¼å•é¡Œï¼Ÿ

## å»ºè­°å¯¦ä½œ
æ‚¨èªç‚ºæ‡‰è©²å¦‚ä½•å¯¦ä½œ

## æ›¿ä»£æ–¹æ¡ˆ
è€ƒæ…®éå“ªäº›å…¶ä»–æ–¹æ¡ˆ

## é¡å¤–è³‡è¨Š
å…¶ä»–ç›¸é—œè³‡è¨Šæˆ–æˆªåœ–
```

### æ”¹å–„æ–‡ä»¶

æ–‡ä»¶è²¢ç»åŒæ¨£é‡è¦ï¼

- ä¿®æ­£éŒ¯å­—æˆ–æ–‡æ³•éŒ¯èª¤
- æ”¹å–„ç¾æœ‰æ–‡ä»¶çš„æ¸…æ™°åº¦
- æ–°å¢éºæ¼çš„æ–‡ä»¶
- ç¿»è­¯æ–‡ä»¶ï¼ˆæœªä¾†å¯èƒ½ï¼‰

## é–‹ç™¼æµç¨‹

### 1. Fork ä¸¦ Clone

```bash
# Fork å°ˆæ¡ˆåˆ°æ‚¨çš„ GitHub å¸³è™Ÿ
# ç„¶å¾Œ clone æ‚¨çš„ fork

git clone https://github.com/YOUR_USERNAME/hls-key-server-go.git
cd hls-key-server-go

# æ–°å¢ä¸Šæ¸¸é ç«¯
git remote add upstream https://github.com/vincent119/hls-key-server-go.git
```

### 2. å»ºç«‹åˆ†æ”¯

```bash
# ç¢ºä¿ä¸»åˆ†æ”¯æ˜¯æœ€æ–°çš„
git checkout main
git pull upstream main

# å»ºç«‹åŠŸèƒ½åˆ†æ”¯
git checkout -b feature/amazing-feature
# æˆ–ä¿®å¾©åˆ†æ”¯
git checkout -b fix/bug-description
```

åˆ†æ”¯å‘½åè¦ç¯„ï¼š

- `feature/åŠŸèƒ½åç¨±` - æ–°åŠŸèƒ½
- `fix/å•é¡Œæè¿°` - Bug ä¿®å¾©
- `docs/æ–‡ä»¶ä¸»é¡Œ` - æ–‡ä»¶æ›´æ–°
- `refactor/é‡æ§‹ç¯„åœ` - ç¨‹å¼ç¢¼é‡æ§‹
- `test/æ¸¬è©¦ç¯„åœ` - æ¸¬è©¦ç›¸é—œ
- `chore/ä»»å‹™æè¿°` - é›œé …ä»»å‹™

### 3. è¨­å®šé–‹ç™¼ç’°å¢ƒ

```bash
# å®‰è£ä¾è³´
go mod download

# åŸ·è¡Œæ¸¬è©¦ç¢ºä¿ç’°å¢ƒæ­£å¸¸
make test

# åŸ·è¡Œ linter
make lint
```

### 4. é€²è¡Œè®Šæ›´

é–‹ç™¼æ™‚è«‹éµå¾ªï¼š

- [ç¨‹å¼ç¢¼è¦ç¯„](#ç¨‹å¼ç¢¼è¦ç¯„)
- [Uber Go Style Guide](https://github.com/uber-go/guide/blob/master/style.md)
- å°ˆæ¡ˆç¾æœ‰çš„æ¶æ§‹æ¨¡å¼

### 5. æ¸¬è©¦

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
make test

# åŸ·è¡Œç‰¹å®šå¥—ä»¶æ¸¬è©¦
go test -v ./internal/service/...

# åŸ·è¡Œ race detector
go test -race ./...

# æŸ¥çœ‹è¦†è“‹ç‡
go test -cover ./...
```

### 6. Commit è®Šæ›´

```bash
# æš«å­˜è®Šæ›´
git add .

# æäº¤ï¼ˆéµå¾ª commit è¨Šæ¯è¦ç¯„ï¼‰
git commit -m "feat: add amazing feature"
```

### 7. æ¨é€ä¸¦å»ºç«‹ Pull Request

```bash
# æ¨é€åˆ°æ‚¨çš„ fork
git push origin feature/amazing-feature

# åœ¨ GitHub ä¸Šå»ºç«‹ Pull Request
```

## ç¨‹å¼ç¢¼è¦ç¯„

### Go ç·¨ç¢¼æ¨™æº–

éµå¾ª **Uber Go Style Guide** å’Œ **Effective Go**ï¼š

#### 1. å‘½åè¦ç¯„

```go
// âœ… Good - ä½¿ç”¨é§å³°å¼å‘½å
type UserService struct {
    repository UserRepository
    logger     *zap.Logger
}

// âŒ Bad - ä½¿ç”¨ä¸‹åŠƒç·š
type user_service struct {
    user_repository UserRepository
}

// âœ… Good - ä»‹é¢å‘½åï¼ˆ-er å¾Œç¶´ï¼‰
type Reader interface {
    Read(p []byte) (n int, err error)
}

// âœ… Good - ç¸®å¯«å…¨å¤§å¯«æˆ–å…¨å°å¯«
userID := "123"
httpServer := &http.Server{}
```

#### 2. éŒ¯èª¤è™•ç†

```go
// âœ… Good - ä½¿ç”¨ sentinel errors
var ErrNotFound = errors.New("not found")

// âœ… Good - éŒ¯èª¤åŒ…è£ä¿ç•™å †ç–Š
if err != nil {
    return fmt.Errorf("failed to load config: %w", err)
}

// âœ… Good - ä½¿ç”¨ errors.Is/As
if errors.Is(err, ErrNotFound) {
    // handle not found
}
```

#### 3. Context ä½¿ç”¨

```go
// âœ… Good - context ä½œç‚ºç¬¬ä¸€å€‹åƒæ•¸
func (s *Service) GetUser(ctx context.Context, id string) (*User, error) {
    // implementation
}

// âŒ Bad - context ä¸æ˜¯ç¬¬ä¸€å€‹åƒæ•¸
func (s *Service) GetUser(id string, ctx context.Context) (*User, error) {
```

#### 4. ä¾è³´æ³¨å…¥

```go
// âœ… Good - å»ºæ§‹å­æ³¨å…¥
func NewService(repo Repository, logger *zap.Logger) *Service {
    return &Service{
        repo:   repo,
        logger: logger,
    }
}

// âŒ Bad - ä½¿ç”¨ init() æˆ–å…¨åŸŸè®Šæ•¸
var globalLogger *zap.Logger

func init() {
    globalLogger = zap.NewProduction()
}
```

#### 5. ä»‹é¢å®šç¾©

```go
// âœ… Good - åœ¨ä½¿ç”¨æ–¹å®šç¾©å°ä»‹é¢
type KeyRepository interface {
    Get(ctx context.Context, name string) ([]byte, error)
    List(ctx context.Context) []string
}

// âŒ Bad - å¤§è€Œå…¨çš„ä»‹é¢
type Repository interface {
    Get(...)
    List(...)
    Create(...)
    Update(...)
    Delete(...)
    // 10+ more methods
}
```

### æ ¼å¼åŒ–

```bash
# ä½¿ç”¨ gofmt
make fmt

# æˆ–
go fmt ./...

# ä½¿ç”¨ goimportsï¼ˆæ¨è–¦ï¼‰
goimports -w .
```

### Linting

```bash
# åŸ·è¡Œ golangci-lint
make lint

# è‡ªå‹•ä¿®å¾©éƒ¨åˆ†å•é¡Œ
golangci-lint run --fix
```

å¿…é ˆé€šéçš„æª¢æŸ¥ï¼š

- `govet` - Go å®˜æ–¹éœæ…‹åˆ†æ
- `errcheck` - éŒ¯èª¤æª¢æŸ¥
- `staticcheck` - é€²éšéœæ…‹åˆ†æ
- `gosimple` - ç°¡åŒ–å»ºè­°
- `unused` - æœªä½¿ç”¨ç¨‹å¼ç¢¼æª¢æ¸¬

## æäº¤è¨Šæ¯è¦ç¯„

éµå¾ª **Conventional Commits** è¦ç¯„ï¼š

### æ ¼å¼

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type é¡å‹

- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¾©
- `docs`: æ–‡ä»¶è®Šæ›´
- `style`: æ ¼å¼åŒ–ï¼ˆä¸å½±éŸ¿ç¨‹å¼ç¢¼åŠŸèƒ½ï¼‰
- `refactor`: é‡æ§‹ï¼ˆæ—¢éæ–°åŠŸèƒ½ä¹Ÿé bug ä¿®å¾©ï¼‰
- `perf`: æ•ˆèƒ½æ”¹å–„
- `test`: æ¸¬è©¦ç›¸é—œ
- `chore`: å»ºç½®æˆ–è¼”åŠ©å·¥å…·è®Šæ›´
- `ci`: CI/CD ç›¸é—œ

### Scope ç¯„åœ

- `handler`: Handler å±¤
- `service`: Service å±¤
- `repository`: Repository å±¤
- `config`: é…ç½®ç›¸é—œ
- `auth`: èªè­‰ç›¸é—œ
- `api`: API ç›¸é—œ

### ç¯„ä¾‹

```bash
# æ–°åŠŸèƒ½
git commit -m "feat(service): add key caching mechanism"

# Bug ä¿®å¾©
git commit -m "fix(handler): prevent path traversal in key name"

# æ–‡ä»¶
git commit -m "docs(readme): update API usage examples"

# é‡æ§‹
git commit -m "refactor(repository): simplify key loading logic"

# æ•ˆèƒ½
git commit -m "perf(service): optimize JWT validation"

# Breaking change
git commit -m "feat(api)!: change authentication endpoint

BREAKING CHANGE: /auth endpoint moved to /api/v1/auth"
```

## æ¸¬è©¦è¦æ±‚

### å¿…é ˆæ¢ä»¶

æ‰€æœ‰ Pull Request å¿…é ˆï¼š

1. âœ… **é€šéæ‰€æœ‰ç¾æœ‰æ¸¬è©¦**
2. âœ… **æ–°ç¨‹å¼ç¢¼æœ‰å°æ‡‰æ¸¬è©¦**
3. âœ… **æ¸¬è©¦è¦†è“‹ç‡ä¸é™ä½**
4. âœ… **é€šé race detector**

### æ¸¬è©¦é¡å‹

#### å–®å…ƒæ¸¬è©¦

```go
// æ¸¬è©¦æª”æ¡ˆå‘½å: *_test.go
func TestNewService(t *testing.T) {
    logger := zap.NewNop()
    repo := &mockRepository{}

    service := NewService(repo, logger)

    if service == nil {
        t.Fatal("expected non-nil service")
    }
}
```

#### Table-Driven Testsï¼ˆæ¨è–¦ï¼‰

```go
func TestService_GetKey(t *testing.T) {
    tests := []struct {
        name        string
        keyName     string
        setupMock   func(*mockRepository)
        expectedErr error
    }{
        {
            name:    "existing key",
            keyName: "test.key",
            setupMock: func(m *mockRepository) {
                m.keys["test.key"] = []byte("data")
            },
            expectedErr: nil,
        },
        {
            name:        "non-existent key",
            keyName:     "missing.key",
            setupMock:   func(m *mockRepository) {},
            expectedErr: ErrKeyNotFound,
        },
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            mock := &mockRepository{keys: make(map[string][]byte)}
            tt.setupMock(mock)
            service := NewService(mock, zap.NewNop())

            _, err := service.GetKey(context.Background(), tt.keyName)

            if !errors.Is(err, tt.expectedErr) {
                t.Errorf("expected error %v, got %v", tt.expectedErr, err)
            }
        })
    }
}
```

#### HTTP æ•´åˆæ¸¬è©¦

```go
func TestHandler_GetKey(t *testing.T) {
    gin.SetMode(gin.TestMode)
    router := setupTestRouter()

    req := httptest.NewRequest("POST", "/api/v1/hls/key", nil)
    w := httptest.NewRecorder()

    router.ServeHTTP(w, req)

    if w.Code != http.StatusOK {
        t.Errorf("expected status 200, got %d", w.Code)
    }
}
```

### åŸ·è¡Œæ¸¬è©¦

```bash
# æ‰€æœ‰æ¸¬è©¦
make test

# ç‰¹å®šå¥—ä»¶
go test -v ./internal/service/

# è¦†è“‹ç‡å ±å‘Š
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out

# Race detector
go test -race ./...

# Benchmark
go test -bench=. -benchmem ./...
```

## Pull Request æµç¨‹

### æäº¤å‰æª¢æŸ¥æ¸…å–®

- [ ] ç¨‹å¼ç¢¼éµå¾ªå°ˆæ¡ˆé¢¨æ ¼æŒ‡å—
- [ ] å·²åŸ·è¡Œ `make lint` ä¸”ç„¡éŒ¯èª¤
- [ ] å·²åŸ·è¡Œ `make test` ä¸”å…¨éƒ¨é€šé
- [ ] æ–°å¢æˆ–æ›´æ–°äº†ç›¸é—œæ¸¬è©¦
- [ ] æ–°å¢æˆ–æ›´æ–°äº†ç›¸é—œæ–‡ä»¶
- [ ] Commit è¨Šæ¯éµå¾ªè¦ç¯„
- [ ] å·²å¾ main åˆ†æ”¯ rebase æœ€æ–°ç¨‹å¼ç¢¼

### PR æè¿°ç¯„æœ¬

```markdown
## è®Šæ›´é¡å‹
- [ ] Bug fix
- [ ] New feature
- [ ] Breaking change
- [ ] Documentation update

## æè¿°
ç°¡çŸ­æè¿°æ­¤ PR çš„è®Šæ›´å…§å®¹

## ç›¸é—œ Issue
Fixes #123

## è®Šæ›´å…§å®¹
- è®Šæ›´é …ç›® 1
- è®Šæ›´é …ç›® 2

## æ¸¬è©¦
æè¿°æ‚¨å¦‚ä½•æ¸¬è©¦æ­¤è®Šæ›´

## æˆªåœ–ï¼ˆå¦‚é©ç”¨ï¼‰
æ–°å¢ç›¸é—œæˆªåœ–

## æª¢æŸ¥æ¸…å–®
- [ ] æˆ‘çš„ç¨‹å¼ç¢¼éµå¾ªå°ˆæ¡ˆé¢¨æ ¼æŒ‡å—
- [ ] æˆ‘å·²åŸ·è¡Œè‡ªæˆ‘ review
- [ ] æˆ‘å·²æ–°å¢å¿…è¦çš„è¨»è§£
- [ ] æˆ‘å·²æ›´æ–°æ–‡ä»¶
- [ ] æˆ‘çš„è®Šæ›´ä¸æœƒç”¢ç”Ÿæ–°çš„è­¦å‘Š
- [ ] æˆ‘å·²æ–°å¢æ¸¬è©¦è­‰æ˜ä¿®å¾©æœ‰æ•ˆæˆ–åŠŸèƒ½é‹ä½œ
- [ ] æ–°èˆŠå–®å…ƒæ¸¬è©¦éƒ½åœ¨æœ¬åœ°é€šé
```

### Review æµç¨‹

1. **è‡ªå‹•æª¢æŸ¥** - CI/CD æœƒè‡ªå‹•åŸ·è¡Œæ¸¬è©¦å’Œ linter
2. **ç¨‹å¼ç¢¼å¯©æŸ¥** - ç¶­è­·è€…æœƒå¯©æŸ¥æ‚¨çš„ç¨‹å¼ç¢¼
3. **è¨è«–** - å¦‚æœ‰éœ€è¦ï¼Œæœƒåœ¨ PR ä¸­è¨è«–
4. **ä¿®æ”¹** - æ ¹æ“šåé¥‹é€²è¡Œä¿®æ”¹
5. **åˆä½µ** - é€šéå¯©æŸ¥å¾Œåˆä½µåˆ° main

### å›æ‡‰ Review æ„è¦‹

- å°å»ºè¨­æ€§æ‰¹è©•ä¿æŒé–‹æ”¾æ…‹åº¦
- æ¸…æ¥šè§£é‡‹æ‚¨çš„è¨­è¨ˆæ±ºç­–
- å¦‚æœä¸åŒæ„ï¼Œç¦®è²Œåœ°è¨è«–
- åŠæ™‚å›æ‡‰ review æ„è¦‹
- å®Œæˆä¿®æ”¹å¾Œæ¨™è¨˜ç‚ºå·²è§£æ±º

## ç‰ˆæœ¬ç™¼å¸ƒ

ç‰ˆæœ¬è™Ÿéµå¾ª **Semantic Versioning (SemVer)**ï¼š

- `MAJOR.MINOR.PATCH`
- `MAJOR`: ä¸ç›¸å®¹çš„ API è®Šæ›´
- `MINOR`: å‘å¾Œç›¸å®¹çš„æ–°åŠŸèƒ½
- `PATCH`: å‘å¾Œç›¸å®¹çš„ bug ä¿®å¾©

ç¯„ä¾‹ï¼š`v1.2.3`

## ç²å¾—å¹«åŠ©

å¦‚æœæ‚¨éœ€è¦å¹«åŠ©ï¼š

1. **æŸ¥çœ‹æ–‡ä»¶** - README.mdã€ARCHITECTURE.md
2. **æœå°‹ Issues** - çœ‹çœ‹æ˜¯å¦æœ‰äººé‡åˆ°ç›¸åŒå•é¡Œ
3. **é–‹å•Ÿ Discussion** - åœ¨ Discussions æå•
4. **è¯çµ¡ç¶­è­·è€…** - é€é Issue æˆ– email

## è‡´è¬

æ„Ÿè¬æ‰€æœ‰è²¢ç»è€…ï¼æ‚¨çš„è²¢ç»è®“é€™å€‹å°ˆæ¡ˆæ›´å¥½ã€‚

è²¢ç»è€…åå–®ï¼š[CONTRIBUTORS.md](CONTRIBUTORS.md)ï¼ˆæœªä¾†å»ºç«‹ï¼‰

## æˆæ¬Š

è²¢ç»åˆ°æœ¬å°ˆæ¡ˆå³è¡¨ç¤ºæ‚¨åŒæ„æ‚¨çš„è²¢ç»å°‡ä¾ç…§ [MIT License](LICENSE) æˆæ¬Šã€‚

---

**å†æ¬¡æ„Ÿè¬æ‚¨çš„è²¢ç»ï¼** ğŸ‰

æœ‰ä»»ä½•å•é¡Œï¼Œæ­¡è¿éš¨æ™‚é–‹å•Ÿ Issue æˆ– Discussionã€‚
